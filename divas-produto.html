<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Produto</title>
  <link rel="icon" type="image/png" href="divas.png">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: Arial, sans-serif; 
      background-color: #fff; 
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .nav-wrapper { position: sticky; top: 0; background: #fff; z-index: 1000; }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 8px 16px; }
    .menu-icon, .bag-icon { font-size: 28px; cursor: pointer; position: relative; }
    .bag-icon .cart-count {
      position: absolute; top: -4px; right: -8px;
      background: #ff0000; color: #fff; font-size: 12px;
      padding: 2px 6px; border-radius: 12px; display: none;
    }
    .logo img { max-height: 80px; width: auto; cursor: pointer; }
    .search-container { display: flex; width: 100%; padding: 0 16px 16px; }
    .search-input {
      flex: 1; padding: 12px;
      border: 1px solid #ccc; border-radius: 8px 0 0 8px;
      outline: none; font-size: 16px; background-color: #f2f2f2;
    }
    .search-button {
      background-color: #ff69b4; border: none;
      padding: 0 16px; border-radius: 0 8px 8px 0;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
    }
    .search-button img { height: 36px; width: auto; }
    .categories-container {
      display: flex; gap: 16px; overflow-x: auto;
      scroll-behavior: smooth; padding: 8px 16px 16px;
    }
    .category { cursor: pointer; white-space: nowrap; padding: 8px 0; }
    
    /* Main content wrapper */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    /* Estilos do produto único */
    .produto-container { 
      padding: 16px; 
      min-height: 300px;
    } 
    .breadcrumb-list { font-size: 14px; color: #666; margin-bottom: 16px; } 
    .breadcrumb-list a { color: #007bff; text-decoration: none; } 
    .carousel img {
      max-width: 100%;
      height: 350px;
      object-fit: cover;
      border-radius: 8px;
    }
    .carousel img { width: 100%; border-radius: 8px; } 
    .badge { position: absolute; top: 8px; left: 8px; background: rgba(255,0,0,0.8); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 14px; } 
    .counter { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.6); color: #fff; padding: 4px 8px; border-radius: 12px; font-size: 14px; } 
    .thumbnails { display: flex; justify-content: center; gap: 8px; margin-bottom: 16px; } 
    .thumbnails img { width: 60px; height: 60px; object-fit: cover; border: 2px solid #ddd; border-radius: 4px; cursor: pointer; } 
    .thumbnails img.active { border-color: #007bff; } 
    .produto-nome { font-size: 24px; font-weight: bold; color: #333; margin-bottom: 8px; } 
    .produto-preco { font-size: 24px; font-weight: bold; color: #000; margin-bottom: 8px; } 
    .produto-parcelamento { font-size: 15px; color: #666; margin-bottom: 8px; } 
    .produto-extra { font-size: 14px; color: #007bff; margin-bottom: 16px; } 
    .options { margin-bottom: 16px; } 
    .options-label { font-size: 14px; margin-bottom: 4px; } 
    .option-swatch { display: inline-block; padding: 6px 12px; border: 2px solid #ccc; border-radius: 4px; cursor: pointer; font-size: 14px; margin-right: 8px; } 
    .option-swatch.selected { border-color: #000; } 
    .purchase-controls { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; } 
    .qty-controls { display: flex; align-items: center; border: 1px solid #ccc; border-radius: 8px; } 
    .qty-controls button { background: none; border: none; font-size: 18px; padding: 8px 12px; cursor: pointer; } 
    .qty-controls .qty { padding: 0 12px; font-size: 18px; min-width: 24px; text-align: center; } 
    .buy-btn { flex: 1; background-color: #ff69b4; color: #fff; border: none; padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer; } 
    .info-section { font-size: 14px; color: #555; margin-bottom: 4px; } 
    .descricao { font-size: 14px; color: #333; margin-top: 8px; line-height: 1.5; white-space: pre-line; } 
    hr { border: none; border-top: 1px solid #ddd; margin: 16px 0; }
    
    /* RODAPÉ ROSA */
    .site-footer { 
      background-color: #ff69b4;
      color: #fff;
      padding: 16px;
      margin-top: auto;
    }
    .site-footer .footer-item {
      margin-bottom: 12px;
      font-size: 14px;
    }
    .site-footer .footer-item.instagram {
      margin-bottom: 32px;
    }
    .site-footer .footer-item.instagram img {
      width: 20px;
      height: auto;
      display: block;
    }
    .site-footer .footer-item a {
      color: inherit;
      text-decoration: none;
    }
    .site-footer .footer-item:last-child {
      margin-bottom: 0;
    }
  </style>
</head>
<body>
  <div id="overlayMenu">
    <div class="close-btn">&times;</div>
    <nav>
      <a href="divas-index.html">Início</a>
      <a href="#" id="all-products-link">Produtos</a>
      <a href="miss-index.html">MISS FIT BEACHWEAR</a>
      <a href="divas-contato.html">Contato</a>
    </nav>
  </div>
  
  <div class="nav-wrapper">
    <header class="header">
      <div class="menu-icon">&#9776;</div>
      <a href="divas-index.html" class="logo">
        <img src="logodivas.webp" alt="Logo">
      </a>
      <a href="carrinho.html" class="bag-icon" id="cart-icon">
        &#128717;
        <span class="cart-count" id="cart-count">0</span>
      </a>
    </header>
    <div class="search-container">
      <input class="search-input" type="text" placeholder="O que você está procurando?" />
      <button class="search-button"><img src="lupa.webp" alt="Buscar" /></button>
    </div>
    <div id="cats" class="categories-container">
      <div class="category">BRINCOS</div>
      <div class="category">ANÉIS</div>
      <div class="category">BRACELETES</div>
      <div class="category">COLARES</div>
      <div class="category">CONJUNTOS</div>
      <div class="category">PULSEIRAS</div>
      <div class="category">PERFUMES</div>
      <div class="category">BOLSAS</div>
      <div class="category">CINTOS</div>
      <div class="category">ÓCULOS</div>
    </div>
  </div>
  
  <div class="main-content">
    <!-- Aqui aparece o produto único -->
    <div class="produto-container" id="produto"></div>
  </div>
  
  <!-- RODAPÉ ROSA -->
  <footer class="site-footer">
    <div class="footer-item instagram">
      <a href="https://www.instagram.com/divasbijouxshoes?igsh=MW55M2QzbTJnaGF4bg==" target="_blank" rel="noopener">
        <img src="instagramicon.png" alt="Instagram">
      </a>
    </div>
    <div class="footer-item">
      <a href="https://wa.me/5598992124926" target="_blank" rel="noopener">
        5598992124926
      </a>
    </div>
    <div class="footer-item">
      <a href="tel:+5589982124926">
        98992124926
      </a>
    </div>
    <div class="footer-item copyright">
      © Flowmize – 2025. Todos os direitos reservados.
    </div>
  </footer>
  
  <script>
    // ––––––––––––––––––––––––––––––––––
    // Gerenciamento de carrinho no localStorage
    const CART_KEY = 'cartItems';

    function getCartItems() {
      try {
        return JSON.parse(localStorage.getItem(CART_KEY)) || [];
      } catch {
        return [];
      }
    }

    function setCartItems(items) {
      localStorage.setItem(CART_KEY, JSON.stringify(items));
      renderCartCount();
    }

    function renderCartCount() {
      const cartCountEl = document.getElementById('cart-count');
      const totalQty = getCartItems().reduce((sum, item) => sum + (item.quantidade || 0), 0);
      cartCountEl.textContent = totalQty;
      cartCountEl.style.display = totalQty > 0 ? 'inline-block' : 'none';
    }

    document.addEventListener('DOMContentLoaded', renderCartCount);
    // ––––––––––––––––––––––––––––––––––
    
    // OVERLAY MENU
    const overlay = document.getElementById('overlayMenu');
    document.querySelector('.menu-icon').onclick = () => overlay.classList.add('open');
    overlay.querySelector('.close-btn').onclick = () => overlay.classList.remove('open');
    
    // capturar produto específico se vier pela URL
    const params = new URLSearchParams(window.location.search);
    const nomeProduto = decodeURIComponent(params.get('produto') || '');
    const imagensParam = params.get('imagens') ? JSON.parse(decodeURIComponent(params.get('imagens'))) : [];
    const opcoesParam = params.get('opcoes') ? JSON.parse(decodeURIComponent(params.get('opcoes'))) : [];
    const statusParam = decodeURIComponent(params.get('status') || '');
    const descricaoParam = decodeURIComponent(params.get('descricao') || '');
    const precoParam = decodeURIComponent(params.get('preco') || '');
    const mensagemParam = decodeURIComponent(params.get('mensagem') || '');
    const parcelamentoParam = decodeURIComponent(params.get('parcelamento') || '');

    // Função para formatar o preço corretamente
    function formatPrice(price) {
      if (!price) return '';
      
      // Extrai apenas números e vírgulas/pontos
      const numericValue = price.replace(/[^\d,.]/g, '');
      
      // Verifica se tem vírgula como separador decimal
      if (numericValue.includes(',')) {
        // Formato brasileiro: 1.234,56
        const parts = numericValue.split(',');
        let integerPart = parts[0].replace(/\./g, ''); // Remove pontos dos milhares
        const decimalPart = parts[1] ? parts[1].substring(0, 2) : '00';
        
        // Formata os milhares com pontos
        integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        
        return `R$ ${integerPart},${decimalPart.padEnd(2, '0')}`;
      } else if (numericValue.includes('.')) {
        // Formato internacional: 1,234.56
        const parts = numericValue.split('.');
        if (parts.length > 2) {
          // Tem pontos para milhares e decimal
          const integerPart = parts.slice(0, -1).join('');
          const decimalPart = parts[parts.length - 1].substring(0, 2);
          return `R$ ${integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, '.')},${decimalPart.padEnd(2, '0')}`;
        } else {
          // Apenas ponto decimal
          const integerPart = parts[0];
          const decimalPart = parts[1] ? parts[1].substring(0, 2) : '00';
          return `R$ ${integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, '.')},${decimalPart.padEnd(2, '0')}`;
        }
      } else {
        // Apenas números inteiros
        if (numericValue.length === 0) return '';
        const formatted = numericValue.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        return `R$ ${formatted},00`;
      }
    }

    // renderiza produto único
    function renderProduto() {
      const container = document.getElementById('produto');
      
      let html = `<div class="breadcrumb-list"><a href="divas-index.html">Início</a> &gt; ${nomeProduto}</div>`;
      html += `
        <div class="carousel">
          ${statusParam ? `<div class="badge">${statusParam}</div>` : ''}
          <img id="carousel-image" src="" alt="${nomeProduto}">
          <div class="counter" id="image-counter"></div>
        </div>
        <div class="thumbnails" id="thumbnails"></div>
        <div class="produto-nome">${nomeProduto}</div>
        <div class="produto-preco">${formatPrice(precoParam)}</div>
        <div class="produto-parcelamento">${parcelamentoParam}</div>
        ${mensagemParam ? `<div class="produto-extra">${mensagemParam}</div>` : ''}
      `;
      
      if (opcoesParam.length > 0) {
        html += `
          <div class="options">
            <div class="options-label">Opções:</div>
            <div id="option-list"></div>
          </div>
        `;
      }
      
      html += `
        <div class="purchase-controls">
          <div class="qty-controls">
            <button id="decrease">-</button>
            <div class="qty" id="quantity">1</div>
            <button id="increase">+</button>
          </div>
          <button class="buy-btn">COMPRAR</button>
        </div>
        <strong>Compra protegida</strong>
        <div class="info-section">Seus dados cuidados durante toda a compra.</div><hr>
        <strong>Trocas e devoluções</strong>
        <div class="info-section">Se não gostar, você pode trocar ou devolver em até 7 dias após a entrega.</div><hr>
        <strong>Descrição</strong>
        <div class="descricao">${descricaoParam}</div>
      `;
      
      container.innerHTML = html;

      // carrossel...
      let idx = 0;
      const imgEl = document.getElementById('carousel-image');
      const countEl = document.getElementById('image-counter');
      const thumbsEl = document.getElementById('thumbnails');
      
      function showImage(i) {
        if (imagensParam.length === 0) return;
        idx = i;
        imgEl.src = imagensParam[i];
        countEl.textContent = `${i+1}/${imagensParam.length}`;
      }
      
      if (imagensParam.length > 0) {
        imagensParam.forEach((u, i) => {
          const t = document.createElement('img');
          t.src = u;
          t.onclick = () => {
            showImage(i);
            thumbsEl.querySelectorAll('img').forEach(x => x.classList.remove('active'));
            t.classList.add('active');
          };
          thumbsEl.appendChild(t);
        });
        showImage(0);
        if (thumbsEl.firstChild) {
          thumbsEl.firstChild.classList.add('active');
        }
      }

      // variantes
      if (opcoesParam.length > 0) {
        const list = document.getElementById('option-list');
        opcoesParam.forEach((o, i) => {
          const sw = document.createElement('div');
          sw.className = 'option-swatch';
          sw.textContent = o;
          sw.onclick = () => {
            document.querySelectorAll('.option-swatch').forEach(x => x.classList.remove('selected'));
            sw.classList.add('selected');
            if (imagensParam.length > i) {
              showImage(i);
            }
          };
          list.appendChild(sw);
        });
      }

      // qtd
      let qty = 1;
      document.getElementById('decrease').onclick = () => { 
        if (qty > 1) qty--; 
        document.getElementById('quantity').textContent = qty; 
      };
      document.getElementById('increase').onclick = () => { 
        qty++; 
        document.getElementById('quantity').textContent = qty; 
      };

      document.querySelector('.buy-btn').onclick = () => {
        // 1. Captura dados do produto
        const nome = nomeProduto;
        const precoText = document.querySelector('.produto-preco').textContent.replace('R$ ', '');
        const quantidade = parseInt(document.getElementById('quantity').textContent, 10);
        const opcaoEl = document.querySelector('.option-swatch.selected');
        const opcao = opcaoEl ? opcaoEl.textContent : null;

        // 2. Adiciona/atualiza item no carrinho
        const items = getCartItems();
        const existente = items.find(i => i.nome === nome && i.opcao === opcao);
        if (existente) {
          existente.quantidade += quantidade;
        } else {
          items.push({ 
            nome, 
            preco: precoText, 
            quantidade, 
            opcao,
            imagens: imagensParam
          });
        }
        setCartItems(items);
        
        // Feedback visual
        const btn = document.querySelector('.buy-btn');
        btn.textContent = 'ADICIONADO!';
        btn.style.backgroundColor = '#4CAF50';
        setTimeout(() => {
          btn.textContent = 'COMPRAR';
          btn.style.backgroundColor = '#ff69b4';
        }, 2000);
      };
    }

    // Inicia a renderização do produto
    if (nomeProduto) {
      renderProduto();
    }

    // atualiza carrinho ao voltar de outra aba
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) renderCartCount();
    });
  </script>
</body>
</html>
