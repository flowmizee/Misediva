<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Produto</title>
  <link rel="icon" type="image/png" href="divas.png">
  <style>
    /* --- Seu CSS original preservado --- */
    html, body { margin: 0; padding: 0; height: 100%; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background-color: #fff; display: flex; flex-direction: column; min-height: 100vh; }
    .nav-wrapper { position: sticky; top: 0; background: #fff; z-index: 1000; }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 8px 16px; }
    .menu-icon, .bag-icon { font-size: 28px; cursor: pointer; position: relative; }
    .bag-icon .cart-count { position: absolute; top: -4px; right: -8px; background: #ff0000; color: #fff; font-size: 12px; padding: 2px 6px; border-radius: 12px; display: none; }
    .logo img { max-height: 80px; width: auto; cursor: pointer; }
    .search-container { display: flex; width: 100%; padding: 0 16px 16px; }
    .search-input { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 8px 0 0 8px; outline: none; font-size: 16px; background-color: #f2f2f2; }
    .search-button { background-color: #ff69b4; border: none; padding: 0 16px; border-radius: 0 8px 8px 0; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .search-button img { height: 36px; width: auto; }
    .categories-container { display: flex; gap: 16px; overflow-x: auto; scroll-behavior: smooth; padding: 8px 16px 16px; }
    .category { cursor: pointer; white-space: nowrap; padding: 8px 0; }

    .main-content { flex: 1; display: flex; flex-direction: column; }
    .produtos-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; padding: 16px; min-height: 300px; }
    .produto { cursor: pointer; }
    .produto img { width: 100%; height: 240px; object-fit: cover; border-radius: 8px; margin-bottom: 12px; }
    .produto .nome { font-size: 14px; font-weight: bold; margin-bottom: 8px; text-transform: capitalize; }
    .produto .preco { font-size: 20px; font-weight: bold; margin-bottom: 8px; }
    .produto .parcelamento, .produto .extra { font-size: 13px; margin-bottom: 8px; }
    .produto .extra { color: #007bff; }

    .produto-container { padding: 16px; min-height: 300px; }
    .breadcrumb-list { font-size: 14px; color: #666; margin-bottom: 16px; }
    .breadcrumb-list a { color: #007bff; text-decoration: none; }
    .carousel img { max-width: 100%; height: 350px; object-fit: cover; border-radius: 8px; }
    .carousel img { width: 100%; border-radius: 8px; }
    .badge { position: absolute; top: 8px; left: 8px; background: rgba(255,0,0,0.8); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 14px; }
    .counter { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.6); color: #fff; padding: 4px 8px; border-radius: 12px; font-size: 14px; }
    .thumbnails { display: flex; justify-content: center; gap: 8px; margin-bottom: 16px; }
    .thumbnails img { width: 60px; height: 60px; object-fit: cover; border: 2px solid #ddd; border-radius: 4px; cursor: pointer; }
    .thumbnails img.active { border-color: #007bff; }
    .produto-nome { font-size: 24px; font-weight: bold; color: #333; margin-bottom: 8px; }
    .produto-preco { font-size: 24px; font-weight: bold; color: #000; margin-bottom: 8px; }
    .produto-parcelamento { font-size: 15px; color: #666; margin-bottom: 8px; }
    .produto-extra { font-size: 14px; color: #007bff; margin-bottom: 16px; }
    .options { margin-bottom: 16px; }
    .options-label { font-size: 14px; margin-bottom: 4px; }
    .option-swatch { display: inline-block; padding: 6px 12px; border: 2px solid #ccc; border-radius: 4px; cursor: pointer; font-size: 14px; margin-right: 8px; }
    .option-swatch.selected { border-color: #000; }
    .purchase-controls { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }
    .qty-controls { display: flex; align-items: center; border: 1px solid #ccc; border-radius: 8px; }
    .qty-controls button { background: none; border: none; font-size: 18px; padding: 8px 12px; cursor: pointer; }
    .qty-controls .qty { padding: 0 12px; font-size: 18px; min-width: 24px; text-align: center; }
    .buy-btn { flex: 1; background-color: #ff69b4; color: #fff; border: none; padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer; position: relative; overflow: visible; }
    .info-section { font-size: 14px; color: #555; margin-bottom: 4px; }
    .descricao { font-size: 14px; color: #333; margin-top: 8px; line-height: 1.5; }
    hr { border: none; border-top: 1px solid #ddd; margin: 16px 0; }

    #breadcrumb { display: none; background: #fff; border-bottom: 1px solid #eee; padding: 8px 16px; }
    #breadcrumb .path { font-size: 14px; color: #007bff; cursor: pointer; text-decoration: underline; }
    #breadcrumb .separator { font-size: 14px; color: #555; margin: 0 8px; }
    #breadcrumb .crumbName { font-size: 14px; text-transform: capitalize; }
    .header-row { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
    .header-row .title { font-weight: bold; font-size: 20px; text-transform: uppercase; }
    .header-row .count { font-size: 14px; color: #555; }

    #overlayMenu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; transform: translateX(-100%); transition: transform 0.3s ease; z-index: 2000; padding: 60px 20px; display: flex; flex-direction: column; }
    #overlayMenu.open { transform: translateX(0); }
    #overlayMenu .close-btn { position: absolute; top: 16px; right: 16px; font-size: 32px; cursor: pointer; }
    #overlayMenu nav { display: flex; flex-direction: column; gap: 0; margin-top: 20px; }
    #overlayMenu nav a { font-size: 20px; color: #000; text-decoration: none; text-transform: uppercase; padding: 8px 0; }

    .site-footer { background-color: #ff69b4; color: #fff; padding: 16px; margin-top: auto; }
    .site-footer .footer-item { margin-bottom: 12px; font-size: 14px; }
    .site-footer .footer-item.instagram { margin-bottom: 32px; }
    .site-footer .footer-item.instagram img { width: 20px; height: auto; display: block; }
    .site-footer .footer-item a { color: inherit; text-decoration: none; }
    .site-footer .footer-item:last-child { margin-bottom: 0; }

    /* Flying image animation (cloned element) */
    .flying-image {
      position: fixed;
      z-index: 9999;
      pointer-events: none;
      will-change: transform, opacity;
      transition: transform 700ms cubic-bezier(.2,.8,.2,1), opacity 700ms ease;
      border-radius: 8px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    }
  </style>
</head>
<body>
  <div id="overlayMenu">
    <div class="close-btn">&times;</div>
    <nav>
      <a href="divas-index.html">Início</a>
      <a href="#" id="all-products-link">Produtos</a>
      <a href="miss-index.html">MISS FIT BEACHWEAR</a>
      <a href="divas-contato.html">Contato</a>
    </nav>
  </div>
  
  <div class="nav-wrapper">
    <header class="header">
      <div class="menu-icon">&#9776;</div>
      <a href="divas-index.html" class="logo">
        <img src="logodivas.webp" alt="Logo">
      </a>
      <a href="carrinho.html" class="bag-icon" id="cart-icon">
        &#128717;
        <span class="cart-count" id="cart-count">0</span>
      </a>
    </header>
    <div class="search-container">
      <input class="search-input" type="text" placeholder="O que você está procurando?" />
      <button class="search-button"><img src="lupa.webp" alt="Buscar" /></button>
    </div>
    <div id="cats" class="categories-container">
      <div class="category">BRINCOS</div>
      <div class="category">ANÉIS</div>
      <div class="category">BRACELETES</div>
      <div class="category">COLARES</div>
      <div class="category">CONJUNTOS</div>
      <div class="category">PULSEIRAS</div>
      <div class="category">PERFUMES</div>
      <div class="category">BOLSAS</div>
      <div class="category">CINTOS</div>
      <div class="category">ÓCULOS</div>
    </div>
  </div>
  
  <div class="main-content">
    <!-- Breadcrumb -->
    <div id="breadcrumb">
      <span class="path">Início</span>
      <span class="separator">&gt;</span>
      <span class="crumbName"></span>
      <div class="header-row">
        <span class="title"></span>
        <span class="count"></span>
      </div>
    </div>
    
    <!-- Produto -->
    <div class="produto-container" id="produto"></div>
    
    <!-- Grid (invisível até uso) -->
    <div id="produtos" class="produtos-grid" style="display:none;"></div>
  </div>
  
  <footer class="site-footer">
    <div class="footer-item instagram">
      <a href="https://www.instagram.com/divasbijouxshoes?igsh=MW55M2QzbTJnaGF4bg==" target="_blank" rel="noopener">
        <img src="instagramicon.png" alt="Instagram">
      </a>
    </div>
    <div class="footer-item">
      <a href="https://wa.me/5598992124926" target="_blank" rel="noopener">
        5598992124926
      </a>
    </div>
    <div class="footer-item">
      <a href="tel:+5589982124926">
        98992124926
      </a>
    </div>
    <div class="footer-item copyright">
      © Flowmize – 2025. Todos os direitos reservados.
    </div>
  </footer>
  
  <script>
    // ====== CONFIG ======
    const CART_KEY = 'cartItems';
    // APPSCRIPT URL informado por você
    const APPSCRIPT_URL = "https://script.google.com/macros/s/AKfycbyMEY0_WEeZaFcRBaGqXM29Z5JlP0VnWyP_eW7upDKF-9EAXmtmpvt7lArtkuu87xZl/exec";

    // ====== UTILIDADES DE CARRINHO ======
    function getCartItems() {
      try {
        return JSON.parse(localStorage.getItem(CART_KEY)) || [];
      } catch {
        return [];
      }
    }
    function setCartItems(items) {
      localStorage.setItem(CART_KEY, JSON.stringify(items));
      renderCartCount();
    }
    function renderCartCount() {
      const cartCountEl = document.getElementById('cart-count');
      const items = getCartItems();
      const total = items.reduce((s, it) => s + (parseInt(it.quantidade || 0, 10) || 0), 0);
      cartCountEl.textContent = total;
      cartCountEl.style.display = total > 0 ? 'inline-block' : 'none';
    }

    // Inicializa contador
    document.addEventListener('DOMContentLoaded', () => renderCartCount());

    // ====== HELPERS ======
    function safeJSONparseMaybeEncoded(param) {
      // param possivelmente veio como encodeURIComponent(JSON.stringify(...))
      if (!param) return null;
      try {
        // tenta decodificar e fazer parse
        const decoded = decodeURIComponent(param);
        // se o decode não alterou e não for JSON, tentou parse mesmo assim
        return JSON.parse(decoded);
      } catch (e1) {
        try {
          return JSON.parse(param); // tentar sem decode
        } catch (e2) {
          // fallback: se for string com vírgulas e sem JSON, retorna array dividido (só se necessário)
          if (typeof param === 'string' && param.indexOf(',') !== -1) {
            return param.split(',').map(s => s.trim()).filter(Boolean);
          }
          return null;
        }
      }
    }

    function normalizeText(text){
      if(!text) return '';
      try { return text.normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim(); } catch { return String(text).toLowerCase().trim(); }
    }

    // ====== LÓGICA DE RECEBIMENTO DOS DADOS ======
    const urlParams = new URLSearchParams(window.location.search);
    const paramProduto = urlParams.get('produto') ? decodeURIComponent(urlParams.get('produto')) : '';
    const paramImagensRaw = urlParams.get('imagens') || null;
    const paramOpcoesRaw = urlParams.get('opcoes') || null;

    let allProdutos = []; // caso precise renderizar grid
    let currentProduct = null;

    // Se veio imagens/opcoes via URL usamos direto
    const providedImagens = safeJSONparseMaybeEncoded(paramImagensRaw);
    const providedOpcoes = safeJSONparseMaybeEncoded(paramOpcoesRaw);

    // Mostrar produto: reutilizável
    function showProdutoFromData(produtoData) {
      if (!produtoData) return;
      currentProduct = produtoData;
      const container = document.getElementById('produto');
      document.getElementById('produtos').style.display = 'none';
      // Breadcrumb escondido por padrão (sua página original escondia)
      document.getElementById('breadcrumb').style.display = 'none';

      const nome = produtoData.nome || '';
      const images = Array.isArray(produtoData.imagens) ? produtoData.imagens : (produtoData.imagens ? [produtoData.imagens] : []);
      const options = Array.isArray(produtoData.opcoes) ? produtoData.opcoes : (produtoData.opcoes ? [produtoData.opcoes] : []);
      const status = produtoData.status || '';
      const desc = produtoData.descricao || '';
      let preco = produtoData.preco || '';
      const extra = produtoData.mensagem || '';
      const parc = produtoData.parcelamento || '';

      // Formata preço defensivamente (aceita vírgulas)
      preco = (preco || '').toString().trim();
      // Remove tudo que não é dígito, ponto ou vírgula, exceto preserva , ou .
      preco = preco.replace(/[^\d.,]/g, '');
      // unify to "x,yy"
      if (preco && !preco.includes(',')) {
        // se tem ponto como decimal
        if (preco.indexOf('.') !== -1) {
          preco = preco.replace('.', ',');
        } else {
          // sem separador, assume inteiro
          preco = preco + ',00';
        }
      }

      // Monta HTML
      let html = `<div class="breadcrumb-list"><a href="divas-index.html">Início</a> &gt; ${nome}</div>`;
      html += `<div class="carousel" style="position:relative;">${status ? `<div class="badge">${status}</div>` : ''}<img id="carousel-image" src="" alt="${nome}"><div class="counter" id="image-counter"></div></div>`;
      html += `<div class="thumbnails" id="thumbnails"></div>`;
      html += `<div class="produto-nome">${nome}</div>`;
      html += `<div class="produto-preco">R$ ${preco}</div>`;
      if (parc) html += `<div class="produto-parcelamento">${parc}</div>`;
      if (extra) html += `<div class="produto-extra">${extra}</div>`;

      if (options && options.length) {
        html += `<div class="options"><div class="options-label">Opções:</div><div id="option-list"></div></div>`;
      }

      html += `
        <div class="purchase-controls">
          <div class="qty-controls">
            <button id="decrease">-</button>
            <div class="qty" id="quantity">1</div>
            <button id="increase">+</button>
          </div>
          <button class="buy-btn" id="buy-btn">ADICIONAR AO CARRINHO</button>
        </div>
        <strong>Compra protegida</strong>
        <div class="info-section">Seus dados cuidados durante toda a compra.</div><hr>
        <strong>Trocas e devoluções</strong>
        <div class="info-section">Se não gostar, você pode trocar ou devolver em até 7 dias após a entrega.</div><hr>
        <strong>Descrição</strong>
        <div class="descricao">${desc}</div>
      `;

      container.innerHTML = html;

      // configura imagens e thumbs
      const imgEl = document.getElementById('carousel-image');
      const counterEl = document.getElementById('image-counter');
      const thumbsEl = document.getElementById('thumbnails');

      let index = 0;
      function showImage(i) {
        if (!images[i]) return;
        index = i;
        imgEl.src = images[i];
        counterEl.textContent = `${i + 1}/${images.length}`;
        // active thumbnail handled separately
        thumbsEl.querySelectorAll('img').forEach((t, idx) => {
          if (idx === i) t.classList.add('active'); else t.classList.remove('active');
        });
      }

      images.forEach((src, i) => {
        const t = document.createElement('img');
        t.src = src;
        t.alt = produtoData.nome || '';
        t.onclick = () => showImage(i);
        thumbsEl.appendChild(t);
      });

      if (images.length > 0) {
        showImage(0);
        const firstThumb = thumbsEl.querySelector('img');
        if (firstThumb) firstThumb.classList.add('active');
      } else {
        imgEl.style.display = 'none';
        counterEl.style.display = 'none';
      }

      // opções
      if (options && options.length) {
        const list = document.getElementById('option-list');
        options.forEach((opt, i) => {
          const sw = document.createElement('div');
          sw.className = 'option-swatch';
          sw.textContent = opt;
          sw.onclick = () => {
            document.querySelectorAll('.option-swatch').forEach(x => x.classList.remove('selected'));
            sw.classList.add('selected');
            // opcional: se quiser trocar imagem conforme opção, aqui poderia escolher showImage(i) — só se fizer sentido
          };
          list.appendChild(sw);
        });
      }

      // quantidade
      let qty = 1;
      document.getElementById('decrease').onclick = () => {
        if (qty > 1) qty--;
        document.getElementById('quantity').textContent = qty;
      };
      document.getElementById('increase').onclick = () => {
        qty++;
        document.getElementById('quantity').textContent = qty;
      };

      // ação de compra com animação voadora
      document.getElementById('buy-btn').onclick = (ev) => {
        const opcaoEl = document.querySelector('.option-swatch.selected');
        const opcao = opcaoEl ? opcaoEl.textContent : null;
        const productName = nome;
        const precoText = preco;
        const quantidade = parseInt(document.getElementById('quantity').textContent, 10) || 1;

        // animação: clona imagem visível (carousel-image)
        const sourceImg = document.getElementById('carousel-image');
        if (sourceImg && sourceImg.src) {
          flyImageToCart(sourceImg).then(() => {
            // ao final da animação, atualiza o cart no localStorage
            addToCartAndPersist({ nome: productName, preco: precoText, quantidade, opcao, imagens: images });
          });
        } else {
          // sem imagem, só atualiza o cart
          addToCartAndPersist({ nome: productName, preco: precoText, quantidade, opcao, imagens: images });
        }
      };
    } // end showProdutoFromData

    // adiciona ao carrinho (persist)
    function addToCartAndPersist(item) {
      const items = getCartItems();
      // se já existir o mesmo nome+opcao => soma quantidade
      const exists = items.find(i => i.nome === item.nome && (i.opcao || '') === (item.opcao || ''));
      if (exists) {
        exists.quantidade = (parseInt(exists.quantidade || 0, 10) || 0) + (parseInt(item.quantidade || 0, 10) || 0);
      } else {
        // garantia de tipos
        item.quantidade = parseInt(item.quantidade || 0, 10) || 0;
        items.push(item);
      }
      setCartItems(items);
      // não usamos alert — UX visual já com animação. opcional: poderia mostrar micro-badge em canto.
    }

    // animação: clonar imagem e mover para o ícone do carrinho (canto do cart-icon)
    function flyImageToCart(sourceImg) {
      return new Promise((resolve) => {
        try {
          const rect = sourceImg.getBoundingClientRect();
          // clone
          const clone = sourceImg.cloneNode(true);
          clone.className = 'flying-image';
          clone.style.width = rect.width + 'px';
          clone.style.height = rect.height + 'px';
          clone.style.left = rect.left + 'px';
          clone.style.top = rect.top + 'px';
          clone.style.opacity = '1';
          document.body.appendChild(clone);

          // target = cart icon
          const cartIcon = document.getElementById('cart-icon');
          const cartRect = cartIcon.getBoundingClientRect();

          // compute translate and scale
          const targetX = cartRect.left + (cartRect.width / 2) - (rect.left + rect.width / 2);
          const targetY = cartRect.top + (cartRect.height / 2) - (rect.top + rect.height / 2);
          const scale = 0.18; // shrink while flying

          // force reflow then transform
          requestAnimationFrame(() => {
            clone.style.transform = `translate(${targetX}px, ${targetY}px) scale(${scale})`;
            clone.style.opacity = '0.2';
          });

          // remove after animation
          clone.addEventListener('transitionend', function handler() {
            clone.removeEventListener('transitionend', handler);
            clone.remove();
            resolve();
          });

          // safety timeout
          setTimeout(() => {
            if (document.body.contains(clone)) {
              clone.remove();
              resolve();
            }
          }, 1000);
        } catch (err) {
          console.warn('flyImageToCart failed', err);
          resolve();
        }
      });
    }

    // ====== Quando a página é carregada: usamos os params (se vieram) ou buscamos o catálogo ======
    (function initPage() {
      // se vieram imagens/opcoes via URL, priorizamos (não precisamos buscar todo catálogo)
      if (paramProduto && (providedImagens || providedOpcoes)) {
        // monta objeto mínimo com os dados fornecidos
        const produtoObj = {
          nome: paramProduto,
          imagens: providedImagens || [],
          opcoes: providedOpcoes || [],
          status: urlParams.get('status') ? decodeURIComponent(urlParams.get('status')) : '',
          descricao: urlParams.get('descricao') ? decodeURIComponent(urlParams.get('descricao')) : '',
          preco: urlParams.get('preco') ? decodeURIComponent(urlParams.get('preco')) : '',
          mensagem: urlParams.get('mensagem') ? decodeURIComponent(urlParams.get('mensagem')) : '',
          parcelamento: urlParams.get('parcelamento') ? decodeURIComponent(urlParams.get('parcelamento')) : ''
        };
        showProdutoFromData(produtoObj);
        return;
      }

      // Caso contrário, tentamos buscar o catálogo (GET) e encontrar o produto por nome.
      // Fazemos fetch normal e, se falhar por CORS, tentamos JSONP fallback.
      fetchCatalogWithFallback().then(data => {
        if (!data || data.status !== 'success') {
          // mostra mensagem simples
          const cont = document.getElementById('produto');
          cont.innerHTML = '<div style="padding:20px;text-align:center;">Não foi possível carregar o produto no momento.</div>';
          return;
        }
        allProdutos = data.produtos || [];
        // se nome veio na URL, encontra e mostra
        if (paramProduto) {
          const prodExact = allProdutos.find(p => p.nome === paramProduto);
          if (prodExact) {
            showProdutoFromData(prodExact);
            return;
          } else {
            // tentativa com comparações normalizadas (ignora acentos/case)
            const normalizedTarget = normalizeText(paramProduto);
            const found = allProdutos.find(p => normalizeText(p.nome || '') === normalizedTarget || normalizeText(p.nome || '').includes(normalizedTarget));
            if (found) {
              showProdutoFromData(found);
              return;
            }
          }
          // não encontrou: mostra aviso e permite procurar pelo nome
          const cont = document.getElementById('produto');
          cont.innerHTML = `<div style="padding:20px;text-align:center;">Produto "${paramProduto}" não encontrado.</div>`;
        } else {
          // nenhum produto solicitado: mostra grid com todos os produtos
          renderProdutosGrid(allProdutos);
        }
      });
    })();

    // ====== Fetch + JSONP fallback (para casos GitHub Pages / CORS) ======
    function fetchCatalogWithFallback() {
      // tentativa fetch GET
      const url = APPSCRIPT_URL + '?_=' + Date.now();
      return fetch(url, { method: 'GET', cache: 'no-store', headers: { 'Pragma': 'no-cache' } })
        .then(r => r.json())
        .catch(() => fetchCatalogJSONP());
    }
    function fetchCatalogJSONP() {
      return new Promise((resolve, reject) => {
        const cbName = '__divasProdCB' + Date.now() + Math.floor(Math.random()*999);
        window[cbName] = function(data) {
          try { delete window[cbName]; script.remove(); } catch(e) {}
          resolve(data);
        };
        const url = APPSCRIPT_URL + (APPSCRIPT_URL.indexOf('?') === -1 ? '?' : '&') + 'callback=' + cbName + '&_=' + Date.now();
        const script = document.createElement('script');
        script.src = url;
        script.onerror = function(){ try{ delete window[cbName]; script.remove(); } catch(e){}; reject(new Error('JSONP load error')); };
        document.head.appendChild(script);
        // safety timeout
        setTimeout(()=>{ if (window[cbName]) { try{ delete window[cbName]; script.remove(); }catch{}; reject(new Error('JSONP timeout')); } }, 8000);
      });
    }

    // ====== render grid (quando necessário) ======
    function renderProdutosGrid(list) {
      const g = document.getElementById('produtos');
      document.getElementById('produto').style.display = 'none';
      g.style.display = 'grid';
      g.innerHTML = '';
      if (!list || list.length === 0) {
        g.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px;">Nenhum produto encontrado</div>';
        return;
      }
      list.forEach(p => {
        if (!p.nome) return;
        const d = document.createElement('div');
        d.className = 'produto';
        d.onclick = () => { window.location.href = `divas-produto.html?produto=${encodeURIComponent(p.nome)}`; };
        const imgSrc = (p.imagens && p.imagens[0]) ? p.imagens[0] : '';
        d.innerHTML = `
          <img src="${imgSrc}" alt="${p.nome}">
          <div class="nome">${p.nome}</div>
          <div class="preco">${p.preco || ''}</div>
          ${p.parcelamento ? `<div class="parcelamento">${p.parcelamento}</div>` : ''}
          ${p.mensagem ? `<div class="extra">${p.mensagem}</div>` : ''}
        `;
        g.appendChild(d);
      });
    }

    // ====== Categoria/busca/menu handlers (mantive sua lógica) ======
    document.querySelectorAll('.category').forEach(el => {
      el.onclick = () => {
        const nome = el.textContent.trim();
        const filtered = (allProdutos || []).filter(p => {
          const nm = (p.nome || '').toLowerCase();
          return nm.includes(nome.toLowerCase());
        });
        renderProdutosGrid(filtered);
        // Breadcrumb
        document.getElementById('breadcrumb').style.display = 'block';
        document.querySelector('#breadcrumb .path').textContent = 'Início';
        document.querySelector('#breadcrumb .crumbName').textContent = nome.toLowerCase();
        document.querySelector('#breadcrumb .header-row .title').textContent = nome.toUpperCase();
        document.querySelector('#breadcrumb .header-row .count').textContent = `${filtered.length} produto${filtered.length !== 1 ? 's' : ''}`;
        // hide single product
        document.getElementById('produto').style.display = 'none';
      };
    });

    const si = document.querySelector('.search-input');
    const sb = document.querySelector('.search-button');
    si.oninput = () => {
      const t = si.value.trim();
      if (t === '') {
        document.getElementById('produtos').style.display = 'none';
        document.getElementById('produto').style.display = '';
        document.getElementById('breadcrumb').style.display = 'none';
        return;
      }
      const filtered = (allProdutos || []).filter(p => (p.nome || '').toLowerCase().includes(t.toLowerCase()));
      renderProdutosGrid(filtered);
      document.getElementById('breadcrumb').style.display = 'block';
      document.querySelector('#breadcrumb .path').textContent = 'Início';
      document.querySelector('#breadcrumb .crumbName').textContent = t.toLowerCase();
      document.querySelector('#breadcrumb .header-row .title').textContent = t.toUpperCase();
      document.querySelector('#breadcrumb .header-row .count').textContent = `${filtered.length} produto${filtered.length !== 1 ? 's' : ''}`;
    };
    sb.onclick = () => { si.oninput(); };

    // menu produtos
    document.getElementById('all-products-link').addEventListener('click', function(e) {
      e.preventDefault();
      const sorted = [...(allProdutos || [])].sort((a,b) => (a.nome||'').localeCompare(b.nome||'','pt',{sensitivity:'base'}));
      renderProdutosGrid(sorted);
      document.getElementById('breadcrumb').style.display = 'block';
      document.querySelector('#breadcrumb .path').textContent = 'Início';
      document.querySelector('#breadcrumb .crumbName').textContent = 'Todos os Produtos';
      document.querySelector('#breadcrumb .header-row .title').textContent = 'TODOS OS PRODUTOS';
      document.querySelector('#breadcrumb .header-row .count').textContent = `${sorted.length} produto${sorted.length !== 1 ? 's' : ''}`;
    });

    // voltar no breadcrumb
    document.querySelector('#breadcrumb .path').addEventListener('click', function() {
      document.getElementById('produtos').style.display = 'none';
      document.getElementById('produto').style.display = '';
      document.getElementById('breadcrumb').style.display = 'none';
    });

    // fechar menu
    const overlay = document.getElementById('overlayMenu');
    document.querySelector('.menu-icon').onclick = () => overlay.classList.add('open');
    overlay.querySelector('.close-btn').onclick = () => overlay.classList.remove('open');

    // atualização do contador quando volta ao tab
    document.addEventListener('visibilitychange', () => { if (!document.hidden) renderCartCount(); });

  </script>
</body>
</html>
